---
output:
  html_document:
    fig_width: 1
    toc: false
    css: css/extra.css
---

<!-- <video autoplay muted loop id="myVideo"> -->
<!-- <source src="images/waves-ruvim-miksanskiy-pexels.mp4" type="video/mp4"> -->
<!-- </video> -->

<!-- <video autoplay muted loop id="myVideo"> -->
<!-- <source src="images/cliffs-rodnae-pexels.mp4" type="video/mp4"> -->
<!-- </video> -->

<video autoplay muted loop id="myVideo">
<source src="images/sea-ad-urpina-pexels.mp4" type="video/mp4">
</video>

<h3 class="header">  
Assessment Regions
</h3>

<div class="rgncontainer">
<div class="rgnmap">

```{r setup, echo = F, warning = FALSE, message = F}
source("_site.R")
## read spatial
geojson <- file.path("regions_gcs_simple2x.geojson")
rgns <- geojsonio::geojson_read(geojson, what = "sp")
if("rgn_nam" %in% names(rgns@data) & !"rgn_name" %in% names(rgns@data)){
  rgns@data = rgns@data %>% mutate(rgn_name = rgn_nam)
}
```

```{r, out.width = '100%'}
## create and render leaflet map
leaflet::leaflet(data = rgns, height = 580) %>%
  addProviderTiles(providers$Esri.OceanBasemap) %>%
  setView(17.3, 60.2, zoom = 5) %>%
  addPolygons(
    layerId = ~rgn_id,
    stroke = TRUE, opacity = 0.5, weight = 2, fillOpacity = 0.5, smoothFactor = 0.5,
    color = ~colorNumeric("#6fa0b4", rgns$rgn_id)(rgn_id)) %>%
  addPolygons(
    layerId = ~rgn_id,
    popup = paste("<h5><strong>", "Region:", "</strong>",
                  rgns@data$rgn_nam,"</h5>",
                  "<h5><strong>", "Region BHI ID:", "</strong>", rgns@data$rgn_id, "</h5>"),
    fillOpacity = 0,
    stroke = FALSE
  ) %>% 
  htmlwidgets::onRender("
  function(el, t) {
    var defaultStyle = {
      // stroke, ie polygon border
        opacity:     0.5,
        weight:      2,
      // fill, ie polygon interior
        fillOpacity: 0.5,
    };
    var highlightStyle = {
      // stroke, ie polygon border
        opacity:     0.9,
        weight:      6,
      // fill, ie polygon interior
        fillOpacity: 0.9,
    };
    var myMap = this;
    var layers = myMap._layers;
    for(var i in layers) {
      var layer = layers[i];
      if(layer.label) {
        layer.on('mouseover',
          function(e) {
            this.setStyle(highlightStyle);
            // this.bringToFront();
        });
        layer.on('mouseout',
          function(e) {
            this.setStyle(defaultStyle);
            // this.bringToBack();
        });
      }
    }
  }")
```

</div>
<div class="rgntxt">
<br>
<br>
Regions are the fundamental spatial units of analysis for the Ocean Health Index. 
<br>
<br>
Scores are calculated for each region individually and then combined (with an offshore area-weighted average) to produce scores for the entire Baltic Sea.
<br>
<br>
There are 42 BHI regions in the Baltic Sea, created by intersecting exclusive economnic zones (EEZs) with the Baltic Sea subbasins, and splitting the Finnish Archipelago Sea into it's own region according to WFD boundaries.
</div>
</div>

